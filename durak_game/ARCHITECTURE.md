# Архитектура проекта "Карточная игра Дурак"

## Общая структура

Проект реализован с использованием объектно-ориентированного подхода и разделен на несколько ключевых компонентов:

```
Game
 ├── Deck
 │    └── Card
 ├── Player
 │    └── Card
 └── UI Components (текст, кнопки)
```

## Основные классы

### Card

Класс `Card` представляет отдельную игральную карту.

**Основные свойства:**
- `m_suit` - масть карты (червы, бубны, трефы, пики)
- `m_rank` - ранг карты (от 6 до туза)
- `m_faceUp` - положение карты (рубашкой вверх или лицом)
- `m_selected` - выбрана ли карта игроком
- `m_texture` и `m_sprite` - текстура и спрайт для отображения карты

**Основные методы:**
- `getSuit()`, `getRank()` - получение масти и ранга карты
- `setFaceUp()`, `setSelected()` - управление состоянием карты
- `loadTexture()` - загрузка текстуры карты
- `setPosition()`, `draw()` - управление отображением карты
- `contains()` - проверка, содержит ли карта указанную точку (для обработки кликов)
- `canBeat()` - проверка, может ли эта карта побить другую карту

### Deck

Класс `Deck` представляет колоду карт.

**Основные свойства:**
- `m_cards` - вектор карт в колоде
- `m_trumpCard` - козырная карта
- `m_trumpSuit` - козырная масть
- `m_rng` - генератор случайных чисел для перемешивания колоды

**Основные методы:**
- `initialize()` - создание и инициализация колоды
- `shuffle()` - перемешивание колоды
- `drawCard()` - взятие карты из колоды
- `getTrumpSuit()` - получение козырной масти
- `isEmpty()`, `getCardCount()` - проверка состояния колоды
- `setPosition()`, `draw()` - управление отображением колоды
- `loadTextures()` - загрузка текстур для всех карт в колоде

### Player

Класс `Player` представляет игрока (человека или компьютер).

**Основные свойства:**
- `m_name` - имя игрока
- `m_isHuman` - флаг, указывающий, является ли игрок человеком
- `m_hand` - вектор карт в руке игрока
- `m_selectedCardIndex` - индекс выбранной карты

**Основные методы:**
- `addCard()` - добавление карты в руку
- `getCard()`, `removeCard()` - получение и удаление карты из руки
- `selectCard()`, `deselectAllCards()` - управление выбором карт
- `hasCardToBeat()`, `getCardToBeat()` - методы для определения карт для защиты
- `setPosition()`, `arrangeCards()`, `draw()` - управление отображением руки игрока
- `handleCardClick()` - обработка клика по картам в руке

### Game

Класс `Game` является основным классом, управляющим игровым процессом.

**Основные свойства:**
- `m_window` - окно SFML для отрисовки игры
- `m_deck` - колода карт
- `m_player`, `m_opponent` - игрок и компьютерный оппонент
- `m_attackCards`, `m_defenseCards` - карты атаки и защиты на столе
- `m_gameState` - текущее состояние игры
- Различные UI элементы (текст, кнопки)

**Основные методы:**
- `initialize()` - инициализация игры
- `run()` - основной игровой цикл
- `processEvents()` - обработка событий (ввод пользователя)
- `update()` - обновление игрового состояния
- `render()` - отрисовка игры
- `handleMouseClick()` - обработка кликов мыши
- Методы для обработки различных состояний игры (`updateMenu()`, `updatePlayerTurn()` и т.д.)
- `dealCards()` - раздача карт игрокам
- `makeOpponentMove()` - логика хода компьютерного оппонента
- `checkGameOver()`, `determineWinner()` - проверка окончания игры и определение победителя

## Состояния игры

Игра использует конечный автомат для управления игровым процессом. Основные состояния:

1. **MENU** - меню игры
2. **DEALING** - раздача карт
3. **PLAYER_TURN** - ход игрока (атака)
4. **OPPONENT_TURN** - ход компьютера (атака)
5. **PLAYER_DEFENSE** - защита игрока
6. **OPPONENT_DEFENSE** - защита компьютера
7. **GAME_OVER** - игра окончена

## Диаграмма потока игры

```
   ┌─────────┐
   │  MENU   │
   └────┬────┘
        │
        ▼
   ┌─────────┐
   │ DEALING │
   └────┬────┘
        │
   ┌────▼─────┐      ┌────────────────┐
   │PLAYER_TURN│─────►│OPPONENT_DEFENSE│
   └────▲─────┘      └────────┬───────┘
        │                     │
        │                     │
   ┌────┴─────────┐     ┌─────▼────┐
   │PLAYER_DEFENSE│◄────┤OPPONENT_TURN│
   └──────────────┘     └────────────┘
        │                     │
        │                     │
        └─────────┬───────────┘
                  │
                  ▼
             ┌─────────┐
             │GAME_OVER│
             └─────────┘
```

## Взаимодействие компонентов

1. **Инициализация игры:**
   - Создание колоды карт
   - Перемешивание колоды
   - Определение козырной масти
   - Раздача карт игрокам

2. **Ход игрока:**
   - Игрок выбирает карту для хода
   - Карта перемещается на стол
   - Компьютер пытается отбиться

3. **Защита компьютера:**
   - Компьютер ищет карту для защиты
   - Если находит - кладет на стол
   - Если не находит - берет все карты со стола

4. **Ход компьютера:**
   - Компьютер выбирает карту для хода
   - Карта перемещается на стол
   - Игрок пытается отбиться

5. **Защита игрока:**
   - Игрок выбирает карту для защиты
   - Если успешно отбивается - игра продолжается
   - Если берет карты - ход переходит к компьютеру

6. **Окончание игры:**
   - Проверка условий окончания игры
   - Определение победителя
   - Отображение результата

## Используемые паттерны проектирования

1. **Model-View-Controller (MVC)** - разделение логики игры и отображения
2. **State Pattern** - для управления состояниями игры
3. **Factory Method** - для создания карт и колоды
4. **Observer Pattern** - для обработки событий пользовательского интерфейса 